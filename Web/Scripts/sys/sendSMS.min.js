var pageManager=pageManager||{};pageManager=function(){var i=function(){tableName="Clients";r();u()},r=function(){var n=sUrl+"GetDataDirect",t=function(n,t){var i=$(t).map(function(n,t){var i=Object.keys(t);return $("<option />").val(t[i[0]]).text(t[i[1]])}).get();$(n).append(i);$(n).chosen()},i=function(n){var u=commonManger.decoData(n),f=u.list,i=u.list1,r;t("#CityID",f);i&&(r=$("#Message"),r.data("userid",i[0].Value),r.data("pass",i[1].Value),r.data("senderId",i[2].Value))};dataService.callAjax("GET",{actionName:"SMS_Properties"},n,i,commonManger.errorException)},u=function(){var r,u,i,o;$("#CityID").change(function(){var n=$(this).val();n=n!=null&&n.length>1?n.join(","):n;e(n)});$("#SendAll").click(function(n){n.preventDefault();var t=$("#Message"),i=t.val(),r=f(),u=$("#Lang label.active :radio").val(),e={MobileNo:r,Message:i,Unicode:u?u:0,UserID:t.data("userid"),Password:t.data("pass"),SenderID:t.data("senderId")},o=function(n){var t=commonManger.jsnFromXML(n);t&&t.Status==="OK"?commonManger.showMessage("Success!:",t.Status+" Your Message Queued for Delivery."):commonManger.showMessage("SMS send results:",t.Error)};i!==""&&r.length>0?dataService.callAjax("POST",JSON.stringify(e),"/api/sms/SMSToGroup",o,commonManger.errorException):(alert("Please enter sms message."),$("#Message").focus())});r="active";u=function(n,i){n=n?n:0;$("#"+gridId+' tbody > tr:not([visible="false"])').each(function(t,u){(n===0||t<=n)&&(i?$(u).addClass(r).find("input[type=checkbox]").eq(0).prop("checked",!0):$(u).removeClass(r).find("input[type=checkbox]").eq(0).prop("checked",!1))});t()};$("#"+gridId+" > thead > tr > th input[type=checkbox]").eq(0).on("click",function(){var n=this.checked;u(undefined,n)});$("#"+gridId).on("click","td input[type=checkbox]",function(){var n=$(this).closest("tr");n.is(".detail-row ")||(this.checked?n.addClass(r):n.removeClass(r),t())});$("a.select-rows").click(function(n){n.preventDefault();var t=$(this).data("rows");t!==undefined&&(u(undefined,!1),t==="0"?u(undefined,!0):u(t,!0))});autosize($("textarea[class*=autosize]"));i=70;o=function(){$("textarea.limited").inputlimiter({remTextFilter:function(n,t){var r=$("textarea.limited").val().length,t=i-r;return"You have typed "+r+" character"+(r==1?"":"s")+".<br />You have "+t+" character"+(t==1?"":"s")+" remaining."},limitTextFilter:function(){return"Message is limited to "+i+" character"+(i==1?"":"s")+"."}})};o();$('input[type=radio][name="Lang"]').change(function(){var r=$(this),u=r.val(),t=$("textarea.limited"),n=70;u==="1"?(i=n,t.val().toString().length>n&&t.val(function(){return $(this).val().substring(0,n)})):i=140;o()});n()},n=function(){var t=function(n){var r=$(".results tbody").children("tr"),i=n.replace(/ /g,"'):containsi('"),t;$.extend($.expr[":"],{containsi:function(n,t,i){return(n.textContent||n.innerText||"").toLowerCase().indexOf((i[3]||"").toLowerCase())>=0}});$(".results tbody tr").not(":containsi('"+i+"')").each(function(){$(this).attr("visible","false")});$(".results tbody tr:containsi('"+i+"')").each(function(){$(this).attr("visible","true")});t=$('.results tbody tr[visible="true"]').length;$(".counter").text(t);t=="0"?$(".no-result").show():$(".no-result").hide()},n=$(".search");$(".search").keyup(function(){var i=n.val();t(i)});n.val()!==""&&t(n.val())},t=function(){var n=$("#"+gridId+" tbody tr.active").length;n>0&&commonManger.showMessage(n+" client(s) has been selected:","You have "+n+" clients selected for SMS message.")},f=function(){var n=[],t;return $("#"+gridId+" tbody tr.active td:last-child").each(function(){var t=uti.mobieFormat($(this).text());t&&t.length>10&&n.push(t)}),t=n.length>0?n.filter(function(n,t,i){return t===i.indexOf(n)}):[],t.join(";")},e=function(t){formName="aspnetForm";var i={actionName:tableName+"_ListByCity",value:t},r=function(t){var i,r;t=commonManger.decoData(t);i=t.list;i?(r=$(i).map(function(n,t){return'<tr><td class="center"><label class="pos-rel"><input name="no_'+t.Mobile+'" type="checkbox" class="ace"><span class="lbl"><\/span><\/label><\/td><td>'+t.ClientName+"<\/td><td>"+t.CityName+"<\/td><td>"+t.Mobile+"<\/td><\/tr>"}).get(),$("#"+gridId+" tbody").html(r),$(".counter").text(r.length+1),$("#clientsListPanel,#"+formName).removeClass("hidden")):($("#clientsListPanel,#"+formName).addClass("hidden"),$("#"+gridId+" tbody").html(""));n()};dataService.callAjax("GET",i,sUrl+"getdata",r,commonManger.errorException)};return{Init:i}}();