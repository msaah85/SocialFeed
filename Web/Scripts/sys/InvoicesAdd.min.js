var pageManager=function(){"use strict";var t=function(){o();$("#ExpenseID").change(function(){h($(this).val())});$("#btnAddAmount").click(function(n){n.preventDefault();var t=$("#ExpenseID").val();t!=""?s():commonManger.showMessage("Required fields","Please enter all required fields.")});$("#listItems tbody").delegate("tr button.remove","click",function(t){t.preventDefault();var i=$(this).closest("tr");i&&i.css({transition:"background-color 1s","background-color":"red"}).fadeOut("slow").promise().done(function(){i.remove();n()})});$("#listItems tbody").delegate('tr input[type="number"]',"keyup",function(){n()});$("#SaveAll").click(function(n){n.preventDefault();i()});$("#addModal").on("shown.bs.modal",function(){$("#ExpenseID").val("");$("#Cost,#Amount").val("0.0")})},i=function(){if(u()){var n=$("#listItems tbody tr").map(function(n,t){return"0,0,"+$(t).find("td:eq(0)").text()+","+numeral().unformat($(t).find("td:eq(2) input").val())+","+numeral().unformat($(t).find("td:eq(3) input").val())}).get(),t=[$("#InvoiceID").val(),$("#ClientID").val(),$("#AddDate").val(),0,numeral().unformat($("#TotalAmount").text()),numeral().unformat($("#TotalProfit").text()),$("#ContainerNo").val(),$("#DeclarationNo").val()];r(["InvoiceID","ClientID","AddDate","Deleted","TotalAmount","Profit","ContainerNo","DeclarationNo"],t,["InvoiceDetailsID","InvoiceID","ExpenseID","Cost","Amount"],n)}else commonManger.showMessage("Data required","Please enter all mandatory fields.")},r=function(n,t,i,r){var u={fieldsMaster:n,valuesMaster:t,fieldsDetails:i,valuesDetails:r};dataService.callAjax("Post",JSON.stringify(u),"InvoiceAdd.aspx/SaveDataMasterDetails",f,commonManger.errorException)},u=function(){var t=!0,n={client:$("#ClientID").val(),gridLength:$("#listItems tbody tr").length,date:$("#AddDate").val(),container:$("#AddDate").val(),declaration:$("#AddDate").val()};return(n.client===""||n.gridLength<=0||n.date===""||n.container===""||n.declaration==="")&&(t=!1),t},f=function(n){n=n.d;n.Status?window.location.href="InvoicePrint.aspx?id="+n.ID:commonManger.showMessage("Error!","Error occured!:"+n.message)},e=function(t){var u=$.parseXML(t.d),r=$.xml2json(u).list,f=$.xml2json(u).list1,e,o,i;r&&(i=$(r).map(function(n,t){return $("<option />").val(t.ExpenseID).text(t.ExpenseName)}).get(),$("#ExpenseID").append(i).trigger("chosen:updated").trigger("liszt:updated"),e=$(r).map(function(n,t){return $("<tr><td>"+t.ExpenseID+"<\/td><td>"+t.ExpenseName+'<\/td>                             <td><input type="number" value="'+numeral(t.DefaultValue).format("0.0")+'" /><\/td><td><input type="number" value="'+numeral(t.DefaultValue).format("0.0")+'" /><\/td>                             <td><button class="btn btn-minier btn-danger remove" data-rel="tooltip" data-placement="top" data-original-title="Delete" title="Delete"><i class="fa fa-remove icon-only"><\/i><\/button><\/td><\/tr>')}).get(),o=$("#listItems tbody"),o.append(e),n());f&&(i=$(f).map(function(n,t){return $("<option />").val(t.ClientID).text(t.ClientName)}).get(),$("#ClientID").append(i).trigger("chosen:updated").trigger("liszt:updated"))},o=function(){dataService.callAjax("Post",JSON.stringify({actionName:"Invoices_Properties"}),sUrl+"GetDataDirect",e,commonManger.errorException)},s=function(){var t={ExpenseID:$("#ExpenseID").val(),ExpenseName:$("#ExpenseID option:selected").text(),Cost:$("#Cost").val(),Amount:$("#Amount").val()},u=$("#listItems tbody"),r,i;t&&(r=$(t).map(function(n,t){return $("<tr><td>"+t.ExpenseID+"<\/td><td>"+t.ExpenseName+'<\/td>                             <td><input type="number" value="'+numeral(t.Cost).format("0.0")+'" /><\/td><td><input type="number" value="'+numeral(t.Amount).format("0.0")+'" /><\/td>                             <td><button class="btn btn-minier btn-danger remove" data-rel="tooltip" data-placement="top" data-original-title="Delete" title="Delete"><i class="fa fa-remove icon-only"><\/i><\/button><\/td><\/tr>')}).get(),i=!1,$("#listItems tbody tr").each(function(){$(this).children("td:eq(0)").text()===t.ExpenseID&&(i=!0)}),i?commonManger.showMessage("Data Exists:","Data already exists before."):(u.append(r),n()));$(".modal").modal("hide")},n=function(){var t=0,n=0;$("#listItems tbody tr").each(function(){try{var i=$(this).find("td:eq(2) input").val(),r=$(this).find("td:eq(3) input").val();t+=numeral().unformat(i&&!isNaN(i)?i:0)*1;n+=numeral().unformat(r&&!isNaN(r)>0?r:0)*1}catch(u){}});$("#TotalAmount").text(numeral(n).format("0,0.0"));$("#TotalProfit").text(numeral(n-t).format("0,0.0"));n>0?$("#SaveAll").removeClass("hidden"):$("#SaveAll").addClass("hidden")},c=function(){$("#aspnetForm")[0].reset();$("#listItems tbody").html("");$("#TotalAmountDhs").text("0")},h=function(n){var t={actionName:"Expenses_SelectRow",value:n};dataService.callAjax("Post",JSON.stringify(t),sUrl+"GetData",function(n){var i=$.parseXML(n.d),t=$.xml2json(i).list;t&&($("#Cost").val(numeral(t.DefaultValue).format("0.00")),$("#Amount").val(numeral(t.DefaultValue).format("0.00")))},commonManger.errorException)};return{Init:t}}();